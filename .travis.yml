dist: bionic
language: python

python:
  - "3.7"
  - "3.8-dev"

stages:
  - lint
  - test

jobs:
  include:
    - &MYPY
      stage: lint
      name: mypy
      python: "3.7"
      install:
        - pip install mypy
      script:
        - make mypy
    - <<: *MYPY
      python: "3.8-dev"
    - &LINTERS
      name: linters
      python: "3.7"
      install:
        - make install
      script:
        - make flake8
        - make black-check
        - make isort-check
        # - python setup.py check -rms
    - <<: *LINTERS
      python: "3.8-dev"
    - stage: test
      os: windows
      language: shell
      before_install:
        - choco install python
        - python -m pip install --upgrade pip
        - choco install make
      env: PATH=/c/Python37:/c/Python37/Scripts:$PATH

cache:
  pip: true

env:
  global:
    - PIP_DISABLE_PIP_VERSION_CHECK=yes PIP_QUIET=yes

install:
  - pip install codecov
  - pip install -r tests/utils/requirements.txt

script:
  - make ci-test

after_script:
  - codecov -f coverage.xml
